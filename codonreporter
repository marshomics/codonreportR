#!/usr/bin/env python3

import argparse
import subprocess
import sys
import os

def main():
    parser = argparse.ArgumentParser(description='CodonReporter Wrapper Script')
    subparsers = parser.add_subparsers(dest='command', help='Available commands')

    # Define the 'usage' sub-command
    parser_usage = subparsers.add_parser('usage', help='Run codon usage analysis')
    parser_usage.add_argument('-m', '--metadata_file', required=True, help='Path to the metadata file')
    parser_usage.add_argument('-f', '--fasta_dir', required=True, help='Directory containing FASTA files')
    parser_usage.add_argument('-o', '--output_dir', required=True, help='Output directory for codon counts')

    args = parser.parse_args()

    if args.command == 'usage':
        # Path to the R script inside the 'scripts' directory
        script_dir = os.path.join(os.path.dirname(os.path.realpath(__file__)), 'scripts')
        r_script = os.path.join(script_dir, 'usage.R')

        # Build the command to run the R script
        cmd = [
            'Rscript',
            r_script,
            '-m', args.metadata_file,
            '-f', args.fasta_dir,
            '-o', args.output_dir
        ]

        # Execute the R script
        try:
            subprocess.run(cmd, check=True)
        except subprocess.CalledProcessError as e:
            print(f"An error occurred while running the R script: {e}", file=sys.stderr)
            sys.exit(1)
    else:
        parser.print_help()

if __name__ == '__main__':
    main()